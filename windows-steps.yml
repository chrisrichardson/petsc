
steps:
- checkout: self
  clean: true
  fetchDepth: 5
  submodules: true

- task: UsePythonVersion@0
  displayName: Use Python Version 2.7
  inputs:
    versionSpec: '2.7'
    addToPath: true

- task: CondaEnvironment@0
  displayName: Install dependencies
  inputs:
    createCustomEnvironment: True
    environmentName: petsc
    packageSpecs: 'python=2.7.* python-wget'
    createOptions: '-c conda-forge'
    updateConda: false

- script: |
    python -m wget https://download.microsoft.com/download/2/E/C/2EC96D7F-687B-4613-80F6-E10F670A2D97/msmpisdk.msi
    python -m wget https://download.microsoft.com/download/2/E/C/2EC96D7F-687B-4613-80F6-E10F670A2D97/msmpisetup.exe
    msmpisetup.exe -unattend -force
    msiexec /i msmpisdk.msi /q
  displayName: Install MSMPI

- bash: |
    ./configure \
    --COPTFLAGS="-O2 -g" \
    --CXXOPTFLAGS="-O2 -g" \
    --FOPTFLAGS="-O2 -g" \
    --with-debugging=yes \
    --with-fortran-bindings=no \
    --download-blacs \
    --download-hypre \
    --download-metis \
    --download-mumps \
    --download-ptscotch \
    --download-scalapack \
    --download-spai \
    --download-suitesparse \
    --download-superlu \
    --with-scalar-type=real \
    --prefix=/usr/local && \
    make && \
    sudo make install
  displayName: Install PETSc
